<!--
LoopSleuth Web: Grid View Template
- Placeholder for the main grid of clips
- Will be expanded with thumbnails, controls, etc.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LoopSleuth - Clip Grid</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>LoopSleuth - Clip Grid (Web UI)</h1>
    <form method="post" action="/scan_folder" style="margin-bottom:2em;">
        <label for="folder_path">Scan folder for videos:</label>
        <input type="text" id="folder_path" name="folder_path" placeholder="E:/downloads" size="40" required style="margin:0 1em;" />
        <button type="submit">Scan</button>
    </form>
    {% if clips %}
        <div class="grid">
            {% for clip in clips %}
                <div class="card" data-clip-id="{{ clip.id }}">
                    {% if clip.thumbnail_path %}
                        <a class="card-link" href="/clip/{{ clip.id }}">
                            <img class="thumb" src="/thumbs/{{ clip.thumb_filename }}" alt="Thumbnail for {{ clip.filename }}" />
                        </a>
                    {% else %}
                        <div class="thumb placeholder">No Thumbnail</div>
                    {% endif %}
                    <div class="meta">
                        <a class="card-link" href="/clip/{{ clip.id }}">
                            <div class="filename">{{ clip.filename }}</div>
                        </a>
                        {% if clip.duration %}
                            <div class="duration">{{ (clip.duration // 60)|int }}:{{ '%02d' % (clip.duration % 60) }} min</div>
                        {% endif %}
                        <div class="star" style="cursor:pointer;" data-clip-id="{{ clip.id }}" onclick="toggleStar(event)" title="Toggle star">{% if clip.starred %}â˜…{% else %}â˜†{% endif %}</div>
                        <div class="tags">
                            <!-- Tags are always visible as static text -->
                            <span class="tags-text" id="tags-text-{{ clip.id }}">{{ clip.tags or '' }}</span>
                            <button type="button" class="edit-tag-btn" data-clip-id="{{ clip.id }}" onclick="editTags(event)" style="margin-left:0.5em; font-size:0.9em;">âœŽ</button>
                            <!-- Tag input is only shown when editing -->
                            <input type="text" class="tag-input" id="tag-input-{{ clip.id }}" value="{{ clip.tags or '' }}" style="display:none; width:80%; margin-top:0.3em;" onkeyup="tagInputKey(event)" data-clip-id="{{ clip.id }}" />
                            <button type="button" class="save-tag-btn" id="save-tag-btn-{{ clip.id }}" style="display:none; margin-left:0.3em; font-size:0.9em;" data-clip-id="{{ clip.id }}" onclick="saveTags(event)">ðŸ’¾</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No clips found. (This is a placeholder page.)</p>
    {% endif %}
</body>
<script>
function toggleStar(event) {
    event.stopPropagation();
    const clipId = event.target.getAttribute('data-clip-id');
    fetch(`/star/${clipId}`, {method: 'POST'})
        .then(r => r.json())
        .then(data => {
            if (data.starred !== undefined) {
                event.target.textContent = data.starred ? 'â˜…' : 'â˜†';
            }
        });
}
function editTags(event) {
    event.stopPropagation();
    const clipId = event.target.getAttribute('data-clip-id');
    document.getElementById(`tags-text-${clipId}`).style.display = 'none';
    document.getElementById(`tag-input-${clipId}`).style.display = '';
    document.getElementById(`save-tag-btn-${clipId}`).style.display = '';
    document.getElementById(`tag-input-${clipId}`).focus();
}
function tagInputKey(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        event.stopPropagation();
        saveTags(event);
    }
}
function saveTags(event) {
    event.preventDefault();
    event.stopPropagation();
    const clipId = event.target.getAttribute('data-clip-id');
    const input = document.getElementById(`tag-input-${clipId}`);
    const tags = input.value;
    fetch(`/tag/${clipId}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({tags})
    })
    .then(r => r.json())
    .then(data => {
        if (data.tags !== undefined) {
            document.getElementById(`tags-text-${clipId}`).textContent = data.tags;
        }
        document.getElementById(`tags-text-${clipId}`).style.display = '';
        input.style.display = 'none';
        document.getElementById(`save-tag-btn-${clipId}`).style.display = 'none';
    });
}
</script>
</html> 